<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aizhixin.school.mapper.QrMapper">

    <select id="getQrList" parameterType="com.aizhixin.school.dto.QrPageDTO" resultType="com.aizhixin.school.vo.QrVO">
        SELECT tq.pip, tq.c_type, tq.photo, tq.create_time, tq.remark,COUNT(1) total
        FROM t_qr tq
        JOIN t_access ta ON ta.qr_id = tq.id
        JOIN t_user tu ON tu.id = ta.user_id
        <where>
            <if test="qrPageDTO.pip != null and qrPageDTO.pip != ''">
                pip LIKE CONCAT('%', CONCAT(#{qrPageDTO.pip}, '%'))
            </if>

            <if test="qrPageDTO.cType != null and qrPageDTO.cType != ''">
                AND
                c_type = #{qrPageDTO.cType}
            </if>

            <if test="qrPageDTO.openTime != null ">
                AND
                tq.create_time &gt;=#{qrPageDTO.openTime}
            </if>

            <if test="qrPageDTO.stopTime != null ">
                AND
                tq.create_time &lt;=#{qrPageDTO.stopTime}
            </if>
        </where>
        GROUP BY tq.id
    </select>
</mapper>
